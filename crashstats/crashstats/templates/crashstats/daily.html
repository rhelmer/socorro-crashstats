{% extends "crashstats_base.html" %}
{% block site_css %}
  {{ super() }}
  {% compress css %}
  <link rel="stylesheet" type="text/less" href="{{ static('crashstats/css/daily.less') }}">
  {% endcompress %}
{% endblock %}

{% block content %}
<div id="mainbody">

<div class="page-heading">
    <h2>Crashes per Active Daily User</h2>
</div>


<div class="panel daily_search">
    <div class="title daily_search_title">
        <h2>Select a Report</h2>
    </div>

    <div class="body daily_search_body">
        <div id="daily_search">
        <div id="daily_search_version">
            <h3><a href="#" id="click_by_version">Crashes per ADU by Version</a></h3>
            <p>All ADU ratios are generated per 100 ADUs, not per single ADU. "3.5 crashes/ADU" means that there are 3.5 crashes per 100 users, not per user. This ratio also does not distinguish between users who crash multiple times and multiple crashing users.</p>
            <form id="daily_search_version_form" name="daily_search_version_form" action="{{ url('crashstats.daily') }}">

                <input type="hidden" name="form_selection" value="by_version">

                <table class="by_version" border="2">
                    <tr>
                        <th>Product</th>
                        <td>
                        <select id="daily_search_version_form_products" name="p">
                            {% for product_name in products %}
                                {% if product == product_name %}
                                    <option value="{{ product_name }}" selected>{{ product_name }}</option>
                                {% else %}
                                    <option value="{{ product_name }}">{{ product_name }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                        </td>
                    </tr>

                    {% for i in range(4) %}
                    <tr>
                        {% if i == 0 %}
                        <th rowspan="4" valign="top">Versions</th>
                        {% endif %}

                        <td>
                            <select id="version{{ i }}" name="v[]">
                                <option value="">-- versions --</option>
                                {% for r in currentversions|groupby('product') %}
                                    {% if r[0] == product %}
                                        {% for v in r[1] %}
                                            {% if v.featured %}
                                                <option value="{{ v.version }}" {% if v.version == versions[i] %} SELECTED {% endif %}>{{ v.version }}</option>
                                            {% endif %}
                                        {% endfor  %}
                                    {% endif  %}
                                {% endfor %}
                            </select>
                        </td>
                    </tr>
                    {% endfor %}

                    <tr>
                        <th>Type:</th>
                        <td>
                            <span class="radio-item"><label><input type="radio" name="hang_type" value="any" checked="checked"  /> Any</label></span>
                            <span class="radio-item"><label><input type="radio" name="hang_type" value="crash"  /> Crash</label></span>
                            <span class="radio-item"><label><input type="radio" name="hang_type" value="hang"  /> Plugin Hang</label></span>
                        </td>
                    </tr>
                    <tr>
                        <th>O/S</th>
                        <td>
                            <input id="os_Windows_check" type="checkbox" name="os[]" value="Windows" checked="checked"/> Windows
                            <input id="os_Mac_check" type="checkbox" name="os[]" value="Mac OS X" checked="checked"/> Mac OS X
                            <input id="os_Linux_check" type="checkbox" name="os[]" value="Linux" checked="checked"/> Linux
                        </td>
                    </tr>

                    <tr>
                        <td>Date Range</td>
                        <td>
                            <span class="radio-item">
                                <label for="by_build">
                                    <input type="radio" name="date_range_type" id="by_build" value="build" checked="checked"/> Build Date
                                </label>
                            </span>
                            <span class="radio-item">
                                <label for="crash">
                                    <input type="radio" name="date_range_type" id="crash" value="report" checked="checked"/> Crash Date
                                </label>
                            </span>
                          </td>
                    </tr>

                    <tr class="datepicker-daily">
                        <th>When</th>
                        <td>
                        <input class="date" type="text" name="date_start" value="{{ start_date }}" />
                        &nbsp; to &nbsp;
                        <input class="date" type="text" name="date_end" value="{{ end_date }}" />
                        </td>
                    </tr>
                </table>

                <input id="daily_search_version_form_submit" type="submit" name="submit" value="Generate">
            </form>
        </div>

        <div id="daily_search_os">
            <h3><a href="#" id="click_by_os">Crashes per ADU by O/S</a></h3>
            <form id="daily_search_os_form" action="{{ url('crashstats.daily') }}" style="display: none">
                <input type="hidden" name="form_selection" value="by_os">

                <table class="by_version">
                    <tr>
                    <th>Product</th>
                    <td>
                    <select id="daily_search_os_form_products" name="p"></select>
                    </td>
                    </tr>

                    <tr>
                        <th>Version</th>
                        <td>
                            <select id="version4" name="v[]">
                                <option value="">-- versions --</option>
                            </select>
                        </td>
                    </tr>

                    <tr>
                    <th>Type:</th>
                        <td>
                           <span class="radio-item"><label><input type="radio" name="hang_type" value="any" checked="checked"  /> Any</label></span>
                           <span class="radio-item"><label><input type="radio" name="hang_type" value="crash"  /> Crash</label></span>
                           <span class="radio-item"><label><input type="radio" name="hang_type" value="hang"  /> Hang</label></span>
                        </td>
                    </tr>

                    <tr>
                        <td>Date Range</td>
                        <td>
                            <span class="radio-item">
                                <label for="os_by_build">
                                    <input type="radio" name="date_range_type" id="os_by_build" value="build" /> Build Date
                                </label>
                            </span>
                            <span class="radio-item">
                                <label for="os_crash">
                                    <input type="radio" name="date_range_type" id="os_crash" value="report" /> Crash Date
                                </label>
                            </span>
                          </td>
                    </tr>

                    <tr class="datepicker-daily">
                        <th>When</th>
                        <td>
                        <input class="date" type="text" name="date_start" value="2012-04-26" />
                        &nbsp; to &nbsp;
                        <input class="date" type="text" name="date_end" value="2012-05-10" />
                        </td>
                    </tr>
                </table>

                <input type="submit" name="submit" value="Generate">
            </form>
        </div>

        </div>
    </div>
</div>

    <div class="panel daily_graph">
        <div class="title">
            <h2>Crashes per 100 ADUs</h2>
        </div>

        <div class="body">
                <div id="adu-chart"></div>
            <p class="adu-chart-help">This graph uses an approximate <a href="https://wiki.mozilla.org/Socorro/SocorroUI/Branches_Admin#Throttle">throttle value</a> for each version, which may not be completely accurate for the entire time period.</p>
            <div id="adu-chart-legend"></div>
            </div>
    </div>


    <br class="clear" />

    <div class="panel daily_">
        <div class="title">
            <h2>Crashes per ADU</h2>
            <div class="choices">
                <ul>
                    {% if request.META.get('QUERY_STRING') %}
                    <li><a href="{{ request.META.get('QUERY_STRING') }}&amp;format=csv">csv</a></li>
                    {% else %}
                    <li><a href="?format=csv">csv</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>

        <div class="body">
            <table id="crash_data" class="crash_data zebra"></table>
        </div>
        <div class="body">
            <table id="crash_data" class="data-table crash_data zebra">
                <tr>
                    <th class="date" rowspan="2">Date</th>
                {% set crash_date = data_table.dates.iterkeys().next() %}
                {% for crash_info in data_table.dates[crash_date] %}
                    <th class="version" colspan="4">{{ crash_info.version }}</th>
                {% endfor %}
                </tr>
                <tr>
                {% for version in versions %}
                    <th class="stat">Crashes</th>
                    <th class="stat">ADU</th>
                    <th class="stat" title="The throttle rate is the effective throttle rate - the combined throttle rate for client-side throttling and server-side throttling.">Throttle</th>
                    <th class="stat">Ratio</th>
                {% endfor %} 
                </tr> 
                {% for crash_date in data_table.dates %}
                <tr>
                  <td>{{ crash_date }}</td>
                  {% for crash_info in data_table.dates[crash_date] %}
                    <td>{{ crash_info.report_count }}</td>
                    <td>{{ crash_info.adu }}</td>
                    <td title="The throttle rate is the effective throttle rate - the combined throttle rate for client-side throttling and server-side throttling.">{{ crash_info.throttle * 100 }}%</td>
                    <td>{{ crash_info.crash_hadu }}</td>
                  {% endfor %}
                </tr>
                {% endfor %}
                <tr>
                    <td class="date"><strong>Total</strong></td>
                {% for product_version in data_table.totals | sort %}
                  {% set total = data_table.totals[product_version] %}
                    <td class="stat"><strong>{{ total.crashes }}</strong></td>
                    <td class="stat"><strong>{{ total.adu }}</strong></td>
                    <td class="stat" title="The throttle rate is the effective throttle rate - the combined throttle rate for client-side throttling and server-side throttling."><strong>{{ total.throttle * 100 }}%</strong></td>
                    <td class="stat"><strong>{{ total.ratio }}</strong></td>
                {% endfor %}
                </tr>
            </table>
        </div>
    </div>
</div>
{% endblock %}
{% block site_js %}
  {{ super() }}
  <!--[if IE]><script type="text/javascript" src="{{ static('crashstats/js/flot-0.7/excanvas.pack.js') }}"></script><![endif]-->
  {% compress js %}
  <script src="{{ static('crashstats/js/flot-0.7/jquery.flot.pack.js') }}"></script>
  <script src="{{ static('crashstats/js/jquery/plugins/ui/jquery-ui-1.8.16.custom.min.js') }}"></script>
  <script src="{{ static('crashstats/js/socorro/daily.js') }}"></script>
  {% endcompress %}
  <script>
    var data = {{ graph_data | safe }};
    window.socGraphByReportType = false;
  </script>
{% endblock %}
